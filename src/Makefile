.PHONY: all clear rebuild main
CC = gcc
GCOV = -fprofile-arcs -ftest-coverage
CFLAGS = -lstdc++ -lgtest -std=c++17
EXE = unit_tests
TFN = unit_tests.cc

all: test leaks gcov_report clean

test: $(TFN) clean
	@${CC} $<  ${CFLAGS} -o $(EXE)
	@./$(BUILD)$(EXE)

leaks:
	leaks --atExit -- ./$(EXE)

gcov_report:
	gcc  --coverage $(TFN) -o gcov_report -lgtest -lstdc++
	./gcov_report
	lcov -t "stest" -o s21_test.info -c -d .
	genhtml -o report s21_test.info
	open ./report/index.html

clean:
	@/bin/rm -rf *.o *.a build *.gcno *gcda report *.info main *.dSYM *.out gcov_report $(EXE)

rebuild: clean all

# build main
main: clean
# $(CC) $(CFLAGS) main.cc -o main.out
	$(CC) $(CFLAGS) s21_containers/list/s21_list.tpp  main.cc -o main.out
	./main.out